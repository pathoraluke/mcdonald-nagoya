<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>愛知県マック棒グラフ＆名古屋区上塗り</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
  />
  <style>
    html, body, #map { height:100%; margin:0; padding:0; }
    .bar { /* 前回の赤い棒グラフスタイル */ }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <!-- 棒グラフ用データ -->
  <script src="data.js"></script>

  <script>
    const map = L.map('map', {
      center: [35.1815, 136.9066],
      zoom: 11,
      zoomControl: false,
      attributionControl: false
    });

    // ① 愛知県境界（線のみ）
    fetch('Aichi.geojson')
      .then(r=>r.json())
      .then(geojson=>{
        L.geoJSON(geojson, {
          style: { color: '#333', weight: 2, fill: false }
        }).addTo(map);
      });

    // ② 名古屋市区界を薄い黄色で上塗り
    fetch('Nagoyaward.geojson')
      .then(r=>r.json())
      .then(geojson=>{
        L.geoJSON(geojson, {
          style: {
            color: '#333',            // 境界線はグレー
            weight: 1,
            fillColor: '#ffffb2',     // 薄い黄色
            fillOpacity: 0.5
          }
        }).addTo(map);
      });

    // ③ 赤い棒グラフを描画（前回コード）
    function drawBars() {
      data.forEach((d,i) => {
        const h = d.count * 15;
        const icon = L.divIcon({
          className:'',
          html:'<div class="bar" style="width:3px;height:0;background:red;transform-origin:bottom;transition:height 1s;"></div>',
          iconSize:[3,h],
          iconAnchor:[1,h]
        });
        const m = L.marker([d.lat,d.lon],{icon}).addTo(map);
        setTimeout(()=>{
          m.getElement().querySelector('.bar').style.height = h+'px';
        },200+i*100);
      });
    }
    // wait for the map tiles & geojsons
    setTimeout(drawBars, 500);
  </script>
</body>
</html>
